(()=>{"use strict";var t={};function e(t,e){const i=t<e,s=t>=e*(e-1),l=t%e==0,n=(t+1)%e==0;return i&&l?"top-left":i&&n?"top-right":s&&l?"bottom-left":s&&n?"bottom-right":i?"top":s?"bottom":l?"left":n?"right":"center"}t.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),(()=>{var e;t.g.importScripts&&(e=t.g.location+"");var i=t.g.document;if(!e&&i&&(i.currentScript&&(e=i.currentScript.src),!e)){var s=i.getElementsByTagName("script");if(s.length)for(var l=s.length-1;l>-1&&!e;)e=s[l--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),t.p=e})();class i{constructor(t){this.elemModal=null,this.eventShowModal=null,this.eventHideModal=null,this.hiding=!1,this.destroyed=!1,this.animationSpeed=200,this.options=t||{},this.createModal(),this.elemModal.addEventListener("click",this.handlerCloseModal.bind(this)),this.eventShowModal=new CustomEvent("show.modalFunc",{detail:this.elemModal}),this.eventHideModal=new CustomEvent("hide.modalFunc",{detail:this.elemModal})}createModal(){this.elemModal=document.createElement("div");let t,e="";if(this.elemModal.classList.add("modalFunc"),t='<div class="modal__backdrop" data-dismiss="modalFunc"><div class="modal__content"><div class="modal__header"><div class="modal__title" data-modalFunc="title">{{title}}</div><span class="modal__btn-close" data-dismiss="modalFunc" title="Закрыть">×</span></div><div class="modal__body" data-modalFunc="content">{{content}}</div>{{footer}}</div></div>'.replace("{{title}}",this.options.title||"Новое окно"),t=t.replace("{{content}}",this.options.content||""),this.options.footerButtons){for(const t of this.options.footerButtons){let i='<button type="button" class="{{button_class}}" data-handler={{button_handler}}>{{button_text}}</button>'.replace("{{button_class}}",t.class);i=i.replace("{{button_handler}}",t.handler),i=i.replace("{{button_text}}",t.text),e+=i}e='<div class="modal__footer">{{buttons}}</div>'.replace("{{buttons}}",e)}t=t.replace("{{footer}}",e),this.elemModal.innerHTML=t,document.body.appendChild(this.elemModal)}show(){this.destroyed||this.hiding||(this.elemModal.classList.add("modal__show"),document.dispatchEvent(this.eventShowModal))}hide(){this.hiding=!0,this.elemModal.classList.remove("modal__show"),this.elemModal.classList.add("modal__hiding"),setTimeout((()=>{this.elemModal.classList.remove("modal__hiding"),this.hiding=!1}),this.animationSpeed),document.dispatchEvent(this.eventHideModal)}handlerCloseModal(t){("modalFunc"===t.target.dataset.dismiss||t.target.dataset.handler)&&this.hide()}destroy(){this.elemModal.parentElement&&this.elemModal.parentElement.removeChild(this.elemModal),this.elemModal.removeEventListener("click",this.handlerCloseModal.bind(this))}setContent(t){this.elemModal.querySelector('[data-modalFunc="content"]').innerHTML=t}setTitle(t){this.elemModal.querySelector('[data-modalFunc="title"]').innerHTML=t}}let s=null;function l(t){const e=function(t){const e=t**2;return Array.from({length:e/8},((t,e)=>8*e)).flatMap((t=>[t,t+1]))}(t);let i;do{i=Math.floor(Math.random()*e.length)}while(e[i]===s);return s=e[i],s}const n={pointer:"pointer",notallowed:"not-allowed",hammer:`url('${t.p+"assets/6dd07f279ae3a4740ad1.png"}'), not-allowed`};class o{constructor(t){this.hitCount=0,this.missCount=0,this.container=t,this.initUI()}initUI(){if(!(this.container instanceof HTMLElement))throw new Error("container is not HTMLElement");this.container.insertAdjacentHTML("afterbegin",`\n    <div class="click-counter">\n        <div>Hit counts: <span class="hit-count">${this.getHitCount()}</span></div>\n        <div>Miss counts: <span class="miss-count">${this.getMissCount()}</span></div>\n    </div>\n    `),this.hitCountEl=this.container.querySelector(".hit-count"),this.missCountEl=this.container.querySelector(".miss-count")}incrementHit(){this.hitCount+=1,this.updateUI()}incrementMiss(){this.missCount+=1,this.updateUI()}updateUI(){this.hitCountEl.textContent=this.getHitCount(),this.missCountEl.textContent=this.getMissCount()}getHitCount(){return this.hitCount}getMissCount(){return this.missCount}reset(){this.missCount=0,this.hitCount=0,this.updateUI()}}const a=new class{constructor(t){this.boardSize=t,this.container=null,this.boardEl=null,this.cells=[],this.cellClickListeners=[],this.cellEnterListeners=[],this.cellLeaveListeners=[],this.isModal=!1,this.initModalListener()}bindToDOM(t){if(!(t instanceof HTMLElement))throw new Error("container is not HTMLElement");this.container=t}initModalListener(){document.addEventListener("click",(t=>{"modalHandlerCancel"===t.target.dataset.handler&&this.currentModal&&(this.currentModal.hide(),this.isModal=!1)}))}drawUi(t){this.checkBinding(),this.container.innerHTML='\n      <div class="board-container">\n        <div data-id="board" class="board"></div>\n      </div>\n    ',this.boardEl=this.container.querySelector("[data-id=board]"),this.boardEl.classList.add(t);for(let t=0;t<this.boardSize**2;t+=1){const i=document.createElement("div");i.classList.add("cell","map-tile",`map-tile-${e(t,this.boardSize)}`),i.addEventListener("mouseenter",(t=>this.onCellEnter(t))),i.addEventListener("mouseleave",(t=>this.onCellLeave(t))),i.addEventListener("click",(t=>this.onCellClick(t))),this.boardEl.appendChild(i)}this.cells=Array.from(this.boardEl.children)}redrawPositions(t){for(const t of this.cells)t.innerHTML="";const e=this.boardEl.children[t],i=document.createElement("div");i.classList.add("character","generic"),e.appendChild(i)}addCellEnterListener(t){this.cellEnterListeners.push(t)}addCellLeaveListener(t){this.cellLeaveListeners.push(t)}addCellClickListener(t){this.cellClickListeners.push(t)}onCellEnter(t){t.preventDefault();const e=this.cells.indexOf(t.currentTarget);this.cellEnterListeners.forEach((t=>t.call(null,e)))}onCellLeave(t){t.preventDefault();const e=this.cells.indexOf(t.currentTarget);this.cellLeaveListeners.forEach((t=>t.call(null,e)))}onCellClick(t){const e=this.cells.indexOf(t.currentTarget);this.cellClickListeners.forEach((t=>t.call(null,e)))}selectCell(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"yellow";this.deselectCell(t),this.cells[t].classList.add("selected",`selected-${e}`)}deselectCell(t){const e=this.cells[t];e.classList.remove(...Array.from(e.classList).filter((t=>t.startsWith("selected"))))}hideCellTooltip(t){this.cells[t].title=""}setCursor(t){this.boardEl.style.cursor=t}checkBinding(){if(null===this.container)throw new Error("GamePlay not bind to DOM")}showModalMessage(t,e){this.isModal||(this.isModal=!0,this.showModal(t,e))}showModal(t,e){const s=new i({title:t,content:`&#${e}`,footerButtons:[{class:"btn btn__cancel",text:"Close",handler:"modalHandlerCancel"}]});this.currentModal=s,s.show()}}(4);a.bindToDOM(document.querySelector("#game-container"));const r=new class{constructor(t){this.gamePlay=t,this.indexSelect=null,this.clickCounter=null,this.onCellClick=this.onCellClick.bind(this),this.onCellEnter=this.onCellEnter.bind(this),this.onCellLeave=this.onCellLeave.bind(this)}init(){this.events(),this.gamePlay.drawUi("prairie"),this.clickCounter=new o(document.querySelector("#game-container")),this.showCharacter()}events(){this.gamePlay.addCellEnterListener(this.onCellEnter),this.gamePlay.addCellLeaveListener(this.onCellLeave),this.gamePlay.addCellClickListener(this.onCellClick)}onCellClick(t){this.reactOnClick(t)}onCellEnter(t){this.gamePlay.setCursor(n.hammer),document.querySelector(".selected-generic")&&this.gamePlay.deselectCell(this.indexSelect),this.gamePlay.selectCell(t),this.indexSelect=t}onCellLeave(t){this.gamePlay.hideCellTooltip(t),this.gamePlay.setCursor(n.pointer)}showCharacter(){this.timerId=setInterval((()=>{const t=l(this.gamePlay.boardSize);this.gamePlay.redrawPositions(t)}),1e3),setTimeout((()=>this.resetTimer()),5e5)}resetTimer(){clearInterval(this.timerId)}reactOnClick(t){document.querySelectorAll(".cell")[t].querySelector(".generic")?(this.clickCounter.incrementHit(),this.clickCounter.getHitCount()>=10&&(this.gamePlay.showModalMessage(`You win! Your points are ${this.clickCounter.getHitCount()}`,"127881"),this.reset())):(this.clickCounter.incrementMiss(),this.clickCounter.getMissCount()>=5&&(this.gamePlay.showModalMessage("You lose!","129335"),this.reset()))}reset(){this.clickCounter.reset()}}(a);r.init()})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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LEtBQ3JDeEYsS0FBS2lHLFNBQVMyQyxpQkFDWCw0QkFBMkI1SSxLQUFLbUosYUFBYTNELGdCQUM5QyxVQUVGeEYsS0FBS2dHLFdBR1BoRyxLQUFLbUosYUFBYXJELGdCQUNkOUYsS0FBS21KLGFBQWExRCxnQkFBa0IsSUFDdEN6RixLQUFLaUcsU0FBUzJDLGlCQUFpQixZQUFhLFVBQzVDNUksS0FBS2dHLFNBR1gsQ0FFQUEsS0FBQUEsR0FDRWhHLEtBQUttSixhQUFhbkQsT0FDcEIsR0ZqRmtDQyxHQUNwQ2dELEVBQVNHLE0iLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9qc19ldmVudHMvd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vanNfZXZlbnRzLy4vc3JjL2pzL3V0aWxzL2NhbGNUaWxlVHlwZS5qcyIsIndlYnBhY2s6Ly9qc19ldmVudHMvd2VicGFjay9ydW50aW1lL2dsb2JhbCIsIndlYnBhY2s6Ly9qc19ldmVudHMvd2VicGFjay9ydW50aW1lL3B1YmxpY1BhdGgiLCJ3ZWJwYWNrOi8vanNfZXZlbnRzLy4vc3JjL2pzL2NvbXBvbmVudHMvTW9kYWwvTW9kYWwuanMiLCJ3ZWJwYWNrOi8vanNfZXZlbnRzLy4vc3JjL2pzL3V0aWxzL2NyZWF0ZVBvc2l0aW9uLmpzIiwid2VicGFjazovL2pzX2V2ZW50cy8uL3NyYy9qcy9jdXJzb3JzLmpzIiwid2VicGFjazovL2pzX2V2ZW50cy8uL3NyYy9qcy9jb21wb25lbnRzL0NsaWNrQ291bnRlci9DbGlja0NvdW50ZXIuanMiLCJ3ZWJwYWNrOi8vanNfZXZlbnRzLy4vc3JjL2pzL2FwcC5qcyIsIndlYnBhY2s6Ly9qc19ldmVudHMvLi9zcmMvanMvY29tcG9uZW50cy9HYW1lUGxheS9HYW1lUGxheS5qcyIsIndlYnBhY2s6Ly9qc19ldmVudHMvLi9zcmMvanMvY29tcG9uZW50cy9HYW1lQ29udHJvbGxlci9HYW1lQ29udHJvbGxlci5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBUaGUgcmVxdWlyZSBzY29wZVxudmFyIF9fd2VicGFja19yZXF1aXJlX18gPSB7fTtcblxuIiwiZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gY2FsY1RpbGVUeXBlKGluZGV4LCBib2FyZFNpemUpIHtcbiAgY29uc3QgaXNUb3BSb3cgPSBpbmRleCA8IGJvYXJkU2l6ZTtcbiAgY29uc3QgaXNCb3R0b21Sb3cgPSBpbmRleCA+PSBib2FyZFNpemUgKiAoYm9hcmRTaXplIC0gMSk7XG4gIGNvbnN0IGlzTGVmdENvbHVtbiA9IGluZGV4ICUgYm9hcmRTaXplID09PSAwO1xuICBjb25zdCBpc1JpZ2h0Q29sdW1uID0gKGluZGV4ICsgMSkgJSBib2FyZFNpemUgPT09IDA7XG5cbiAgaWYgKGlzVG9wUm93ICYmIGlzTGVmdENvbHVtbikgcmV0dXJuICd0b3AtbGVmdCc7XG4gIGlmIChpc1RvcFJvdyAmJiBpc1JpZ2h0Q29sdW1uKSByZXR1cm4gJ3RvcC1yaWdodCc7XG4gIGlmIChpc0JvdHRvbVJvdyAmJiBpc0xlZnRDb2x1bW4pIHJldHVybiAnYm90dG9tLWxlZnQnO1xuICBpZiAoaXNCb3R0b21Sb3cgJiYgaXNSaWdodENvbHVtbikgcmV0dXJuICdib3R0b20tcmlnaHQnO1xuICBpZiAoaXNUb3BSb3cpIHJldHVybiAndG9wJztcbiAgaWYgKGlzQm90dG9tUm93KSByZXR1cm4gJ2JvdHRvbSc7XG4gIGlmIChpc0xlZnRDb2x1bW4pIHJldHVybiAnbGVmdCc7XG4gIGlmIChpc1JpZ2h0Q29sdW1uKSByZXR1cm4gJ3JpZ2h0JztcbiAgcmV0dXJuICdjZW50ZXInO1xufVxuIiwiX193ZWJwYWNrX3JlcXVpcmVfXy5nID0gKGZ1bmN0aW9uKCkge1xuXHRpZiAodHlwZW9mIGdsb2JhbFRoaXMgPT09ICdvYmplY3QnKSByZXR1cm4gZ2xvYmFsVGhpcztcblx0dHJ5IHtcblx0XHRyZXR1cm4gdGhpcyB8fCBuZXcgRnVuY3Rpb24oJ3JldHVybiB0aGlzJykoKTtcblx0fSBjYXRjaCAoZSkge1xuXHRcdGlmICh0eXBlb2Ygd2luZG93ID09PSAnb2JqZWN0JykgcmV0dXJuIHdpbmRvdztcblx0fVxufSkoKTsiLCJ2YXIgc2NyaXB0VXJsO1xuaWYgKF9fd2VicGFja19yZXF1aXJlX18uZy5pbXBvcnRTY3JpcHRzKSBzY3JpcHRVcmwgPSBfX3dlYnBhY2tfcmVxdWlyZV9fLmcubG9jYXRpb24gKyBcIlwiO1xudmFyIGRvY3VtZW50ID0gX193ZWJwYWNrX3JlcXVpcmVfXy5nLmRvY3VtZW50O1xuaWYgKCFzY3JpcHRVcmwgJiYgZG9jdW1lbnQpIHtcblx0aWYgKGRvY3VtZW50LmN1cnJlbnRTY3JpcHQpXG5cdFx0c2NyaXB0VXJsID0gZG9jdW1lbnQuY3VycmVudFNjcmlwdC5zcmM7XG5cdGlmICghc2NyaXB0VXJsKSB7XG5cdFx0dmFyIHNjcmlwdHMgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZShcInNjcmlwdFwiKTtcblx0XHRpZihzY3JpcHRzLmxlbmd0aCkge1xuXHRcdFx0dmFyIGkgPSBzY3JpcHRzLmxlbmd0aCAtIDE7XG5cdFx0XHR3aGlsZSAoaSA+IC0xICYmICFzY3JpcHRVcmwpIHNjcmlwdFVybCA9IHNjcmlwdHNbaS0tXS5zcmM7XG5cdFx0fVxuXHR9XG59XG4vLyBXaGVuIHN1cHBvcnRpbmcgYnJvd3NlcnMgd2hlcmUgYW4gYXV0b21hdGljIHB1YmxpY1BhdGggaXMgbm90IHN1cHBvcnRlZCB5b3UgbXVzdCBzcGVjaWZ5IGFuIG91dHB1dC5wdWJsaWNQYXRoIG1hbnVhbGx5IHZpYSBjb25maWd1cmF0aW9uXG4vLyBvciBwYXNzIGFuIGVtcHR5IHN0cmluZyAoXCJcIikgYW5kIHNldCB0aGUgX193ZWJwYWNrX3B1YmxpY19wYXRoX18gdmFyaWFibGUgZnJvbSB5b3VyIGNvZGUgdG8gdXNlIHlvdXIgb3duIGxvZ2ljLlxuaWYgKCFzY3JpcHRVcmwpIHRocm93IG5ldyBFcnJvcihcIkF1dG9tYXRpYyBwdWJsaWNQYXRoIGlzIG5vdCBzdXBwb3J0ZWQgaW4gdGhpcyBicm93c2VyXCIpO1xuc2NyaXB0VXJsID0gc2NyaXB0VXJsLnJlcGxhY2UoLyMuKiQvLCBcIlwiKS5yZXBsYWNlKC9cXD8uKiQvLCBcIlwiKS5yZXBsYWNlKC9cXC9bXlxcL10rJC8sIFwiL1wiKTtcbl9fd2VicGFja19yZXF1aXJlX18ucCA9IHNjcmlwdFVybDsiLCJpbXBvcnQgJy4vbW9kYWwuY3NzJztcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgTW9kYWwge1xuICBjb25zdHJ1Y3RvcihvcHRpb25zKSB7XG4gICAgdGhpcy5lbGVtTW9kYWwgPSBudWxsO1xuICAgIHRoaXMuZXZlbnRTaG93TW9kYWwgPSBudWxsO1xuICAgIHRoaXMuZXZlbnRIaWRlTW9kYWwgPSBudWxsO1xuICAgIHRoaXMuaGlkaW5nID0gZmFsc2U7XG4gICAgdGhpcy5kZXN0cm95ZWQgPSBmYWxzZTtcbiAgICB0aGlzLmFuaW1hdGlvblNwZWVkID0gMjAwO1xuXG4gICAgdGhpcy5vcHRpb25zID0gb3B0aW9ucyB8fCB7fTtcblxuICAgIHRoaXMuY3JlYXRlTW9kYWwoKTtcbiAgICB0aGlzLmVsZW1Nb2RhbC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHRoaXMuaGFuZGxlckNsb3NlTW9kYWwuYmluZCh0aGlzKSk7XG5cbiAgICB0aGlzLmV2ZW50U2hvd01vZGFsID0gbmV3IEN1c3RvbUV2ZW50KCdzaG93Lm1vZGFsRnVuYycsIHtcbiAgICAgIGRldGFpbDogdGhpcy5lbGVtTW9kYWwsXG4gICAgfSk7XG4gICAgdGhpcy5ldmVudEhpZGVNb2RhbCA9IG5ldyBDdXN0b21FdmVudCgnaGlkZS5tb2RhbEZ1bmMnLCB7XG4gICAgICBkZXRhaWw6IHRoaXMuZWxlbU1vZGFsLFxuICAgIH0pO1xuICB9XG5cbiAgY3JlYXRlTW9kYWwoKSB7XG4gICAgdGhpcy5lbGVtTW9kYWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICBjb25zdCBtb2RhbFRlbXBsYXRlID0gJzxkaXYgY2xhc3M9XCJtb2RhbF9fYmFja2Ryb3BcIiBkYXRhLWRpc21pc3M9XCJtb2RhbEZ1bmNcIj48ZGl2IGNsYXNzPVwibW9kYWxfX2NvbnRlbnRcIj48ZGl2IGNsYXNzPVwibW9kYWxfX2hlYWRlclwiPjxkaXYgY2xhc3M9XCJtb2RhbF9fdGl0bGVcIiBkYXRhLW1vZGFsRnVuYz1cInRpdGxlXCI+e3t0aXRsZX19PC9kaXY+PHNwYW4gY2xhc3M9XCJtb2RhbF9fYnRuLWNsb3NlXCIgZGF0YS1kaXNtaXNzPVwibW9kYWxGdW5jXCIgdGl0bGU9XCLQl9Cw0LrRgNGL0YLRjFwiPsOXPC9zcGFuPjwvZGl2PjxkaXYgY2xhc3M9XCJtb2RhbF9fYm9keVwiIGRhdGEtbW9kYWxGdW5jPVwiY29udGVudFwiPnt7Y29udGVudH19PC9kaXY+e3tmb290ZXJ9fTwvZGl2PjwvZGl2Pic7XG4gICAgY29uc3QgbW9kYWxGb290ZXJUZW1wbGF0ZSA9ICc8ZGl2IGNsYXNzPVwibW9kYWxfX2Zvb3RlclwiPnt7YnV0dG9uc319PC9kaXY+JztcbiAgICBjb25zdCBtb2RhbEJ1dHRvblRlbXBsYXRlID0gJzxidXR0b24gdHlwZT1cImJ1dHRvblwiIGNsYXNzPVwie3tidXR0b25fY2xhc3N9fVwiIGRhdGEtaGFuZGxlcj17e2J1dHRvbl9oYW5kbGVyfX0+e3tidXR0b25fdGV4dH19PC9idXR0b24+JztcbiAgICBsZXQgbW9kYWxIVE1MO1xuICAgIGxldCBtb2RhbEZvb3RlckhUTUwgPSAnJztcblxuICAgIHRoaXMuZWxlbU1vZGFsLmNsYXNzTGlzdC5hZGQoJ21vZGFsRnVuYycpO1xuICAgIG1vZGFsSFRNTCA9IG1vZGFsVGVtcGxhdGUucmVwbGFjZShcbiAgICAgICd7e3RpdGxlfX0nLFxuICAgICAgdGhpcy5vcHRpb25zLnRpdGxlIHx8ICfQndC+0LLQvtC1INC+0LrQvdC+JyxcbiAgICApO1xuICAgIG1vZGFsSFRNTCA9IG1vZGFsSFRNTC5yZXBsYWNlKCd7e2NvbnRlbnR9fScsIHRoaXMub3B0aW9ucy5jb250ZW50IHx8ICcnKTtcbiAgICBpZiAodGhpcy5vcHRpb25zLmZvb3RlckJ1dHRvbnMpIHtcbiAgICAgIGZvciAoY29uc3QgYnV0dG9uIG9mIHRoaXMub3B0aW9ucy5mb290ZXJCdXR0b25zKSB7XG4gICAgICAgIGxldCBtb2RhbEZvb3RlckJ1dHRvbiA9IG1vZGFsQnV0dG9uVGVtcGxhdGUucmVwbGFjZShcbiAgICAgICAgICAne3tidXR0b25fY2xhc3N9fScsXG4gICAgICAgICAgYnV0dG9uLmNsYXNzLFxuICAgICAgICApO1xuICAgICAgICBtb2RhbEZvb3RlckJ1dHRvbiA9IG1vZGFsRm9vdGVyQnV0dG9uLnJlcGxhY2UoXG4gICAgICAgICAgJ3t7YnV0dG9uX2hhbmRsZXJ9fScsXG4gICAgICAgICAgYnV0dG9uLmhhbmRsZXIsXG4gICAgICAgICk7XG4gICAgICAgIG1vZGFsRm9vdGVyQnV0dG9uID0gbW9kYWxGb290ZXJCdXR0b24ucmVwbGFjZShcbiAgICAgICAgICAne3tidXR0b25fdGV4dH19JyxcbiAgICAgICAgICBidXR0b24udGV4dCxcbiAgICAgICAgKTtcbiAgICAgICAgbW9kYWxGb290ZXJIVE1MICs9IG1vZGFsRm9vdGVyQnV0dG9uO1xuICAgICAgfVxuICAgICAgbW9kYWxGb290ZXJIVE1MID0gbW9kYWxGb290ZXJUZW1wbGF0ZS5yZXBsYWNlKFxuICAgICAgICAne3tidXR0b25zfX0nLFxuICAgICAgICBtb2RhbEZvb3RlckhUTUwsXG4gICAgICApO1xuICAgIH1cbiAgICBtb2RhbEhUTUwgPSBtb2RhbEhUTUwucmVwbGFjZSgne3tmb290ZXJ9fScsIG1vZGFsRm9vdGVySFRNTCk7XG4gICAgdGhpcy5lbGVtTW9kYWwuaW5uZXJIVE1MID0gbW9kYWxIVE1MO1xuICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQodGhpcy5lbGVtTW9kYWwpO1xuICB9XG5cbiAgc2hvdygpIHtcbiAgICBpZiAoIXRoaXMuZGVzdHJveWVkICYmICF0aGlzLmhpZGluZykge1xuICAgICAgdGhpcy5lbGVtTW9kYWwuY2xhc3NMaXN0LmFkZCgnbW9kYWxfX3Nob3cnKTtcbiAgICAgIGRvY3VtZW50LmRpc3BhdGNoRXZlbnQodGhpcy5ldmVudFNob3dNb2RhbCk7XG4gICAgfVxuICB9XG5cbiAgaGlkZSgpIHtcbiAgICB0aGlzLmhpZGluZyA9IHRydWU7XG4gICAgdGhpcy5lbGVtTW9kYWwuY2xhc3NMaXN0LnJlbW92ZSgnbW9kYWxfX3Nob3cnKTtcbiAgICB0aGlzLmVsZW1Nb2RhbC5jbGFzc0xpc3QuYWRkKCdtb2RhbF9faGlkaW5nJyk7XG4gICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICB0aGlzLmVsZW1Nb2RhbC5jbGFzc0xpc3QucmVtb3ZlKCdtb2RhbF9faGlkaW5nJyk7XG4gICAgICB0aGlzLmhpZGluZyA9IGZhbHNlO1xuICAgIH0sIHRoaXMuYW5pbWF0aW9uU3BlZWQpO1xuICAgIGRvY3VtZW50LmRpc3BhdGNoRXZlbnQodGhpcy5ldmVudEhpZGVNb2RhbCk7XG4gIH1cblxuICBoYW5kbGVyQ2xvc2VNb2RhbChlKSB7XG4gICAgaWYgKGUudGFyZ2V0LmRhdGFzZXQuZGlzbWlzcyA9PT0gJ21vZGFsRnVuYycgfHwgZS50YXJnZXQuZGF0YXNldC5oYW5kbGVyKSB7XG4gICAgICB0aGlzLmhpZGUoKTtcbiAgICB9XG4gIH1cblxuICBkZXN0cm95KCkge1xuICAgIGlmICh0aGlzLmVsZW1Nb2RhbC5wYXJlbnRFbGVtZW50KSB7XG4gICAgICB0aGlzLmVsZW1Nb2RhbC5wYXJlbnRFbGVtZW50LnJlbW92ZUNoaWxkKHRoaXMuZWxlbU1vZGFsKTtcbiAgICB9XG4gICAgdGhpcy5lbGVtTW9kYWwucmVtb3ZlRXZlbnRMaXN0ZW5lcihcbiAgICAgICdjbGljaycsXG4gICAgICB0aGlzLmhhbmRsZXJDbG9zZU1vZGFsLmJpbmQodGhpcyksXG4gICAgKTtcbiAgfVxuXG4gIHNldENvbnRlbnQoaHRtbCkge1xuICAgIHRoaXMuZWxlbU1vZGFsLnF1ZXJ5U2VsZWN0b3IoJ1tkYXRhLW1vZGFsRnVuYz1cImNvbnRlbnRcIl0nKS5pbm5lckhUTUwgPSBodG1sO1xuICB9XG5cbiAgc2V0VGl0bGUodGV4dCkge1xuICAgIHRoaXMuZWxlbU1vZGFsLnF1ZXJ5U2VsZWN0b3IoJ1tkYXRhLW1vZGFsRnVuYz1cInRpdGxlXCJdJykuaW5uZXJIVE1MID0gdGV4dDtcbiAgfVxufVxuIiwibGV0IGxhc3RQb3NpdGlvbiA9IG51bGw7XG5cbmZ1bmN0aW9uIGNyZWF0ZUFycmF5UG9zaXRpb25zKGJvYXJkU2l6ZSkge1xuICBjb25zdCB0b3RhbENlbGxzID0gYm9hcmRTaXplICoqIDI7XG4gIHJldHVybiBBcnJheS5mcm9tKHsgbGVuZ3RoOiB0b3RhbENlbGxzIC8gOCB9LCAoXywgaSkgPT4gaSAqIDgpLmZsYXRNYXAoXG4gICAgKGNlbGwpID0+IFtjZWxsLCBjZWxsICsgMV0sXG4gICk7XG59XG5cbmV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIGNyZWF0ZVBvc2l0aW9uKGJvYXJkU2l6ZSkge1xuICBjb25zdCBjZWxscyA9IGNyZWF0ZUFycmF5UG9zaXRpb25zKGJvYXJkU2l6ZSk7XG4gIGxldCByYW5kO1xuXG4gIGRvIHtcbiAgICByYW5kID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogY2VsbHMubGVuZ3RoKTtcbiAgfSB3aGlsZSAoY2VsbHNbcmFuZF0gPT09IGxhc3RQb3NpdGlvbik7XG5cbiAgbGFzdFBvc2l0aW9uID0gY2VsbHNbcmFuZF07XG4gIHJldHVybiBsYXN0UG9zaXRpb247XG59XG4iLCJpbXBvcnQgaGFtbWVySW1nIGZyb20gJy4uL2ltZy9oYW1tZXJfc21hbGwucG5nJztcblxuY29uc3QgY3Vyc29ycyA9IHtcbiAgcG9pbnRlcjogJ3BvaW50ZXInLFxuICBub3RhbGxvd2VkOiAnbm90LWFsbG93ZWQnLFxuICBoYW1tZXI6IGB1cmwoJyR7aGFtbWVySW1nfScpLCBub3QtYWxsb3dlZGAsXG59O1xuXG5leHBvcnQgZGVmYXVsdCBjdXJzb3JzO1xuIiwiaW1wb3J0ICcuL2NsaWNrLWNvdW50ZXIuY3NzJztcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgQ2xpY2tDb3VudGVyIHtcbiAgY29uc3RydWN0b3IoY29udGFpbmVyKSB7XG4gICAgdGhpcy5oaXRDb3VudCA9IDA7XG4gICAgdGhpcy5taXNzQ291bnQgPSAwO1xuICAgIHRoaXMuY29udGFpbmVyID0gY29udGFpbmVyO1xuXG4gICAgdGhpcy5pbml0VUkoKTtcbiAgfVxuXG4gIGluaXRVSSgpIHtcbiAgICBpZiAoISh0aGlzLmNvbnRhaW5lciBpbnN0YW5jZW9mIEhUTUxFbGVtZW50KSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdjb250YWluZXIgaXMgbm90IEhUTUxFbGVtZW50Jyk7XG4gICAgfVxuXG4gICAgdGhpcy5jb250YWluZXIuaW5zZXJ0QWRqYWNlbnRIVE1MKFxuICAgICAgJ2FmdGVyYmVnaW4nLFxuICAgICAgYFxuICAgIDxkaXYgY2xhc3M9XCJjbGljay1jb3VudGVyXCI+XG4gICAgICAgIDxkaXY+SGl0IGNvdW50czogPHNwYW4gY2xhc3M9XCJoaXQtY291bnRcIj4ke3RoaXMuZ2V0SGl0Q291bnQoKX08L3NwYW4+PC9kaXY+XG4gICAgICAgIDxkaXY+TWlzcyBjb3VudHM6IDxzcGFuIGNsYXNzPVwibWlzcy1jb3VudFwiPiR7dGhpcy5nZXRNaXNzQ291bnQoKX08L3NwYW4+PC9kaXY+XG4gICAgPC9kaXY+XG4gICAgYCxcbiAgICApO1xuICAgIHRoaXMuaGl0Q291bnRFbCA9IHRoaXMuY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoJy5oaXQtY291bnQnKTtcbiAgICB0aGlzLm1pc3NDb3VudEVsID0gdGhpcy5jb250YWluZXIucXVlcnlTZWxlY3RvcignLm1pc3MtY291bnQnKTtcbiAgfVxuXG4gIGluY3JlbWVudEhpdCgpIHtcbiAgICB0aGlzLmhpdENvdW50ICs9IDE7XG4gICAgdGhpcy51cGRhdGVVSSgpO1xuICB9XG5cbiAgaW5jcmVtZW50TWlzcygpIHtcbiAgICB0aGlzLm1pc3NDb3VudCArPSAxO1xuICAgIHRoaXMudXBkYXRlVUkoKTtcbiAgfVxuXG4gIHVwZGF0ZVVJKCkge1xuICAgIHRoaXMuaGl0Q291bnRFbC50ZXh0Q29udGVudCA9IHRoaXMuZ2V0SGl0Q291bnQoKTtcbiAgICB0aGlzLm1pc3NDb3VudEVsLnRleHRDb250ZW50ID0gdGhpcy5nZXRNaXNzQ291bnQoKTtcbiAgfVxuXG4gIGdldEhpdENvdW50KCkge1xuICAgIHJldHVybiB0aGlzLmhpdENvdW50O1xuICB9XG5cbiAgZ2V0TWlzc0NvdW50KCkge1xuICAgIHJldHVybiB0aGlzLm1pc3NDb3VudDtcbiAgfVxuXG4gIHJlc2V0KCkge1xuICAgIHRoaXMubWlzc0NvdW50ID0gMDtcbiAgICB0aGlzLmhpdENvdW50ID0gMDtcbiAgICB0aGlzLnVwZGF0ZVVJKCk7XG4gIH1cbn1cbiIsImltcG9ydCBHYW1lUGxheSBmcm9tICcuL2NvbXBvbmVudHMvR2FtZVBsYXkvR2FtZVBsYXknO1xuaW1wb3J0IEdhbWVDb250cm9sbGVyIGZyb20gJy4vY29tcG9uZW50cy9HYW1lQ29udHJvbGxlci9HYW1lQ29udHJvbGxlcic7XG5cbmNvbnN0IGdhbWVQbGF5ID0gbmV3IEdhbWVQbGF5KDQpO1xuZ2FtZVBsYXkuYmluZFRvRE9NKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNnYW1lLWNvbnRhaW5lcicpKTtcblxuY29uc3QgZ2FtZUN0cmwgPSBuZXcgR2FtZUNvbnRyb2xsZXIoZ2FtZVBsYXkpO1xuZ2FtZUN0cmwuaW5pdCgpO1xuIiwiaW1wb3J0IGNhbGNUaWxlVHlwZSBmcm9tICcuLi8uLi91dGlscy9jYWxjVGlsZVR5cGUnO1xuaW1wb3J0IE1vZGFsIGZyb20gJy4uL01vZGFsL01vZGFsJztcblxuaW1wb3J0ICcuL2dhbWUtcGxheS5jc3MnO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBHYW1lUGxheSB7XG4gIGNvbnN0cnVjdG9yKGJvYXJkU2l6ZSkge1xuICAgIHRoaXMuYm9hcmRTaXplID0gYm9hcmRTaXplO1xuICAgIHRoaXMuY29udGFpbmVyID0gbnVsbDtcbiAgICB0aGlzLmJvYXJkRWwgPSBudWxsO1xuICAgIHRoaXMuY2VsbHMgPSBbXTtcbiAgICB0aGlzLmNlbGxDbGlja0xpc3RlbmVycyA9IFtdO1xuICAgIHRoaXMuY2VsbEVudGVyTGlzdGVuZXJzID0gW107XG4gICAgdGhpcy5jZWxsTGVhdmVMaXN0ZW5lcnMgPSBbXTtcbiAgICB0aGlzLmlzTW9kYWwgPSBmYWxzZTtcblxuICAgIHRoaXMuaW5pdE1vZGFsTGlzdGVuZXIoKTtcbiAgfVxuXG4gIGJpbmRUb0RPTShjb250YWluZXIpIHtcbiAgICBpZiAoIShjb250YWluZXIgaW5zdGFuY2VvZiBIVE1MRWxlbWVudCkpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignY29udGFpbmVyIGlzIG5vdCBIVE1MRWxlbWVudCcpO1xuICAgIH1cbiAgICB0aGlzLmNvbnRhaW5lciA9IGNvbnRhaW5lcjtcbiAgfVxuXG4gIGluaXRNb2RhbExpc3RlbmVyKCkge1xuICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHtcbiAgICAgIGlmIChcbiAgICAgICAgZS50YXJnZXQuZGF0YXNldC5oYW5kbGVyID09PSAnbW9kYWxIYW5kbGVyQ2FuY2VsJ1xuICAgICAgICAmJiB0aGlzLmN1cnJlbnRNb2RhbFxuICAgICAgKSB7XG4gICAgICAgIHRoaXMuY3VycmVudE1vZGFsLmhpZGUoKTtcbiAgICAgICAgdGhpcy5pc01vZGFsID0gZmFsc2U7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICBkcmF3VWkodGhlbWUpIHtcbiAgICB0aGlzLmNoZWNrQmluZGluZygpO1xuXG4gICAgdGhpcy5jb250YWluZXIuaW5uZXJIVE1MID0gYFxuICAgICAgPGRpdiBjbGFzcz1cImJvYXJkLWNvbnRhaW5lclwiPlxuICAgICAgICA8ZGl2IGRhdGEtaWQ9XCJib2FyZFwiIGNsYXNzPVwiYm9hcmRcIj48L2Rpdj5cbiAgICAgIDwvZGl2PlxuICAgIGA7XG5cbiAgICB0aGlzLmJvYXJkRWwgPSB0aGlzLmNvbnRhaW5lci5xdWVyeVNlbGVjdG9yKCdbZGF0YS1pZD1ib2FyZF0nKTtcblxuICAgIHRoaXMuYm9hcmRFbC5jbGFzc0xpc3QuYWRkKHRoZW1lKTtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuYm9hcmRTaXplICoqIDI7IGkgKz0gMSkge1xuICAgICAgY29uc3QgY2VsbEVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICBjZWxsRWwuY2xhc3NMaXN0LmFkZChcbiAgICAgICAgJ2NlbGwnLFxuICAgICAgICAnbWFwLXRpbGUnLFxuICAgICAgICBgbWFwLXRpbGUtJHtjYWxjVGlsZVR5cGUoaSwgdGhpcy5ib2FyZFNpemUpfWAsXG4gICAgICApO1xuICAgICAgY2VsbEVsLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlZW50ZXInLCAoZXZlbnQpID0+IHRoaXMub25DZWxsRW50ZXIoZXZlbnQpKTtcbiAgICAgIGNlbGxFbC5hZGRFdmVudExpc3RlbmVyKCdtb3VzZWxlYXZlJywgKGV2ZW50KSA9PiB0aGlzLm9uQ2VsbExlYXZlKGV2ZW50KSk7XG4gICAgICBjZWxsRWwuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZXZlbnQpID0+IHRoaXMub25DZWxsQ2xpY2soZXZlbnQpKTtcbiAgICAgIHRoaXMuYm9hcmRFbC5hcHBlbmRDaGlsZChjZWxsRWwpO1xuICAgIH1cblxuICAgIHRoaXMuY2VsbHMgPSBBcnJheS5mcm9tKHRoaXMuYm9hcmRFbC5jaGlsZHJlbik7XG4gIH1cblxuICByZWRyYXdQb3NpdGlvbnMocG9zaXRpb24pIHtcbiAgICBmb3IgKGNvbnN0IGNlbGwgb2YgdGhpcy5jZWxscykge1xuICAgICAgY2VsbC5pbm5lckhUTUwgPSAnJztcbiAgICB9XG5cbiAgICBjb25zdCBjZWxsRWwgPSB0aGlzLmJvYXJkRWwuY2hpbGRyZW5bcG9zaXRpb25dO1xuICAgIGNvbnN0IGNoYXJFbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgIGNoYXJFbC5jbGFzc0xpc3QuYWRkKCdjaGFyYWN0ZXInLCAnZ2VuZXJpYycpO1xuXG4gICAgY2VsbEVsLmFwcGVuZENoaWxkKGNoYXJFbCk7XG4gIH1cblxuICBhZGRDZWxsRW50ZXJMaXN0ZW5lcihjYWxsYmFjaykge1xuICAgIHRoaXMuY2VsbEVudGVyTGlzdGVuZXJzLnB1c2goY2FsbGJhY2spO1xuICB9XG5cbiAgYWRkQ2VsbExlYXZlTGlzdGVuZXIoY2FsbGJhY2spIHtcbiAgICB0aGlzLmNlbGxMZWF2ZUxpc3RlbmVycy5wdXNoKGNhbGxiYWNrKTtcbiAgfVxuXG4gIGFkZENlbGxDbGlja0xpc3RlbmVyKGNhbGxiYWNrKSB7XG4gICAgdGhpcy5jZWxsQ2xpY2tMaXN0ZW5lcnMucHVzaChjYWxsYmFjayk7XG4gIH1cblxuICBvbkNlbGxFbnRlcihldmVudCkge1xuICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgY29uc3QgaW5kZXggPSB0aGlzLmNlbGxzLmluZGV4T2YoZXZlbnQuY3VycmVudFRhcmdldCk7XG4gICAgdGhpcy5jZWxsRW50ZXJMaXN0ZW5lcnMuZm9yRWFjaCgobykgPT4gby5jYWxsKG51bGwsIGluZGV4KSk7XG4gIH1cblxuICBvbkNlbGxMZWF2ZShldmVudCkge1xuICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgY29uc3QgaW5kZXggPSB0aGlzLmNlbGxzLmluZGV4T2YoZXZlbnQuY3VycmVudFRhcmdldCk7XG4gICAgdGhpcy5jZWxsTGVhdmVMaXN0ZW5lcnMuZm9yRWFjaCgobykgPT4gby5jYWxsKG51bGwsIGluZGV4KSk7XG4gIH1cblxuICBvbkNlbGxDbGljayhldmVudCkge1xuICAgIGNvbnN0IGluZGV4ID0gdGhpcy5jZWxscy5pbmRleE9mKGV2ZW50LmN1cnJlbnRUYXJnZXQpO1xuICAgIHRoaXMuY2VsbENsaWNrTGlzdGVuZXJzLmZvckVhY2goKG8pID0+IG8uY2FsbChudWxsLCBpbmRleCkpO1xuICB9XG5cbiAgc2VsZWN0Q2VsbChpbmRleCwgY29sb3IgPSAneWVsbG93Jykge1xuICAgIHRoaXMuZGVzZWxlY3RDZWxsKGluZGV4KTtcbiAgICB0aGlzLmNlbGxzW2luZGV4XS5jbGFzc0xpc3QuYWRkKCdzZWxlY3RlZCcsIGBzZWxlY3RlZC0ke2NvbG9yfWApO1xuICB9XG5cbiAgZGVzZWxlY3RDZWxsKGluZGV4KSB7XG4gICAgY29uc3QgY2VsbCA9IHRoaXMuY2VsbHNbaW5kZXhdO1xuICAgIGNlbGwuY2xhc3NMaXN0LnJlbW92ZShcbiAgICAgIC4uLkFycmF5LmZyb20oY2VsbC5jbGFzc0xpc3QpLmZpbHRlcigobykgPT4gby5zdGFydHNXaXRoKCdzZWxlY3RlZCcpKSxcbiAgICApO1xuICB9XG5cbiAgaGlkZUNlbGxUb29sdGlwKGluZGV4KSB7XG4gICAgdGhpcy5jZWxsc1tpbmRleF0udGl0bGUgPSAnJztcbiAgfVxuXG4gIHNldEN1cnNvcihjdXJzb3IpIHtcbiAgICB0aGlzLmJvYXJkRWwuc3R5bGUuY3Vyc29yID0gY3Vyc29yO1xuICB9XG5cbiAgY2hlY2tCaW5kaW5nKCkge1xuICAgIGlmICh0aGlzLmNvbnRhaW5lciA9PT0gbnVsbCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdHYW1lUGxheSBub3QgYmluZCB0byBET00nKTtcbiAgICB9XG4gIH1cblxuICBzaG93TW9kYWxNZXNzYWdlKG1lc3NhZ2UsIHVuaWNvZGUpIHtcbiAgICBpZiAoIXRoaXMuaXNNb2RhbCkge1xuICAgICAgdGhpcy5pc01vZGFsID0gdHJ1ZTtcbiAgICAgIHRoaXMuc2hvd01vZGFsKG1lc3NhZ2UsIHVuaWNvZGUpO1xuICAgIH1cbiAgfVxuXG4gIHNob3dNb2RhbChtZXNzYWdlLCB1bmljb2RlKSB7XG4gICAgY29uc3QgbW9kYWwgPSBuZXcgTW9kYWwoe1xuICAgICAgdGl0bGU6IG1lc3NhZ2UsXG4gICAgICBjb250ZW50OiBgJiMke3VuaWNvZGV9YCxcbiAgICAgIGZvb3RlckJ1dHRvbnM6IFtcbiAgICAgICAge1xuICAgICAgICAgIGNsYXNzOiAnYnRuIGJ0bl9fY2FuY2VsJyxcbiAgICAgICAgICB0ZXh0OiAnQ2xvc2UnLFxuICAgICAgICAgIGhhbmRsZXI6ICdtb2RhbEhhbmRsZXJDYW5jZWwnLFxuICAgICAgICB9LFxuICAgICAgXSxcbiAgICB9KTtcblxuICAgIHRoaXMuY3VycmVudE1vZGFsID0gbW9kYWw7XG5cbiAgICBtb2RhbC5zaG93KCk7XG4gIH1cbn1cbiIsImltcG9ydCBjcmVhdGVQb3NpdGlvbiBmcm9tICcuLi8uLi91dGlscy9jcmVhdGVQb3NpdGlvbic7XG5pbXBvcnQgY3Vyc29ycyBmcm9tICcuLi8uLi9jdXJzb3JzJztcbmltcG9ydCBDbGlja0NvdW50ZXIgZnJvbSAnLi4vQ2xpY2tDb3VudGVyL0NsaWNrQ291bnRlcic7XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEdhbWVDb250cm9sbGVyIHtcbiAgY29uc3RydWN0b3IoZ2FtZVBsYXkpIHtcbiAgICB0aGlzLmdhbWVQbGF5ID0gZ2FtZVBsYXk7XG4gICAgdGhpcy5pbmRleFNlbGVjdCA9IG51bGw7XG4gICAgdGhpcy5jbGlja0NvdW50ZXIgPSBudWxsO1xuICAgIHRoaXMub25DZWxsQ2xpY2sgPSB0aGlzLm9uQ2VsbENsaWNrLmJpbmQodGhpcyk7XG4gICAgdGhpcy5vbkNlbGxFbnRlciA9IHRoaXMub25DZWxsRW50ZXIuYmluZCh0aGlzKTtcbiAgICB0aGlzLm9uQ2VsbExlYXZlID0gdGhpcy5vbkNlbGxMZWF2ZS5iaW5kKHRoaXMpO1xuICB9XG5cbiAgaW5pdCgpIHtcbiAgICB0aGlzLmV2ZW50cygpO1xuICAgIHRoaXMuZ2FtZVBsYXkuZHJhd1VpKCdwcmFpcmllJyk7XG4gICAgdGhpcy5jbGlja0NvdW50ZXIgPSBuZXcgQ2xpY2tDb3VudGVyKFxuICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI2dhbWUtY29udGFpbmVyJyksXG4gICAgKTtcbiAgICB0aGlzLnNob3dDaGFyYWN0ZXIoKTtcbiAgfVxuXG4gIGV2ZW50cygpIHtcbiAgICB0aGlzLmdhbWVQbGF5LmFkZENlbGxFbnRlckxpc3RlbmVyKHRoaXMub25DZWxsRW50ZXIpO1xuICAgIHRoaXMuZ2FtZVBsYXkuYWRkQ2VsbExlYXZlTGlzdGVuZXIodGhpcy5vbkNlbGxMZWF2ZSk7XG4gICAgdGhpcy5nYW1lUGxheS5hZGRDZWxsQ2xpY2tMaXN0ZW5lcih0aGlzLm9uQ2VsbENsaWNrKTtcbiAgfVxuXG4gIG9uQ2VsbENsaWNrKGUpIHtcbiAgICB0aGlzLnJlYWN0T25DbGljayhlKTtcbiAgfVxuXG4gIG9uQ2VsbEVudGVyKGluZGV4KSB7XG4gICAgdGhpcy5nYW1lUGxheS5zZXRDdXJzb3IoY3Vyc29ycy5oYW1tZXIpO1xuXG4gICAgaWYgKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zZWxlY3RlZC1nZW5lcmljJykpIHtcbiAgICAgIHRoaXMuZ2FtZVBsYXkuZGVzZWxlY3RDZWxsKHRoaXMuaW5kZXhTZWxlY3QpO1xuICAgIH1cblxuICAgIHRoaXMuZ2FtZVBsYXkuc2VsZWN0Q2VsbChpbmRleCk7XG4gICAgdGhpcy5pbmRleFNlbGVjdCA9IGluZGV4O1xuICB9XG5cbiAgb25DZWxsTGVhdmUoaW5kZXgpIHtcbiAgICB0aGlzLmdhbWVQbGF5LmhpZGVDZWxsVG9vbHRpcChpbmRleCk7XG4gICAgdGhpcy5nYW1lUGxheS5zZXRDdXJzb3IoY3Vyc29ycy5wb2ludGVyKTtcbiAgfVxuXG4gIHNob3dDaGFyYWN0ZXIoKSB7XG4gICAgdGhpcy50aW1lcklkID0gc2V0SW50ZXJ2YWwoKCkgPT4ge1xuICAgICAgY29uc3QgcG9zaXRpb24gPSBjcmVhdGVQb3NpdGlvbih0aGlzLmdhbWVQbGF5LmJvYXJkU2l6ZSk7XG4gICAgICB0aGlzLmdhbWVQbGF5LnJlZHJhd1Bvc2l0aW9ucyhwb3NpdGlvbik7XG4gICAgfSwgMTAwMCk7XG5cbiAgICBzZXRUaW1lb3V0KCgpID0+IHRoaXMucmVzZXRUaW1lcigpLCA1MDAwMDApO1xuICB9XG5cbiAgcmVzZXRUaW1lcigpIHtcbiAgICBjbGVhckludGVydmFsKHRoaXMudGltZXJJZCk7XG4gIH1cblxuICByZWFjdE9uQ2xpY2soZSkge1xuICAgIGNvbnN0IGJvYXJkQ2VsbENsaWNrID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmNlbGwnKVtlXTtcbiAgICBjb25zdCBpc0dvYmxpbiA9IGJvYXJkQ2VsbENsaWNrLnF1ZXJ5U2VsZWN0b3IoJy5nZW5lcmljJyk7XG5cbiAgICBpZiAoaXNHb2JsaW4pIHtcbiAgICAgIHRoaXMuY2xpY2tDb3VudGVyLmluY3JlbWVudEhpdCgpO1xuXG4gICAgICBpZiAodGhpcy5jbGlja0NvdW50ZXIuZ2V0SGl0Q291bnQoKSA+PSAxMCkge1xuICAgICAgICB0aGlzLmdhbWVQbGF5LnNob3dNb2RhbE1lc3NhZ2UoXG4gICAgICAgICAgYFlvdSB3aW4hIFlvdXIgcG9pbnRzIGFyZSAke3RoaXMuY2xpY2tDb3VudGVyLmdldEhpdENvdW50KCl9YCxcbiAgICAgICAgICAnMTI3ODgxJyxcbiAgICAgICAgKTtcbiAgICAgICAgdGhpcy5yZXNldCgpO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmNsaWNrQ291bnRlci5pbmNyZW1lbnRNaXNzKCk7XG4gICAgICBpZiAodGhpcy5jbGlja0NvdW50ZXIuZ2V0TWlzc0NvdW50KCkgPj0gNSkge1xuICAgICAgICB0aGlzLmdhbWVQbGF5LnNob3dNb2RhbE1lc3NhZ2UoJ1lvdSBsb3NlIScsICcxMjkzMzUnKTtcbiAgICAgICAgdGhpcy5yZXNldCgpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIHJlc2V0KCkge1xuICAgIHRoaXMuY2xpY2tDb3VudGVyLnJlc2V0KCk7XG4gIH1cbn1cbiJdLCJuYW1lcyI6WyJfX3dlYnBhY2tfcmVxdWlyZV9fIiwiY2FsY1RpbGVUeXBlIiwiaW5kZXgiLCJib2FyZFNpemUiLCJpc1RvcFJvdyIsImlzQm90dG9tUm93IiwiaXNMZWZ0Q29sdW1uIiwiaXNSaWdodENvbHVtbiIsImciLCJnbG9iYWxUaGlzIiwidGhpcyIsIkZ1bmN0aW9uIiwiZSIsIndpbmRvdyIsInNjcmlwdFVybCIsImltcG9ydFNjcmlwdHMiLCJsb2NhdGlvbiIsImRvY3VtZW50IiwiY3VycmVudFNjcmlwdCIsInNyYyIsInNjcmlwdHMiLCJnZXRFbGVtZW50c0J5VGFnTmFtZSIsImxlbmd0aCIsImkiLCJFcnJvciIsInJlcGxhY2UiLCJwIiwiTW9kYWwiLCJjb25zdHJ1Y3RvciIsIm9wdGlvbnMiLCJlbGVtTW9kYWwiLCJldmVudFNob3dNb2RhbCIsImV2ZW50SGlkZU1vZGFsIiwiaGlkaW5nIiwiZGVzdHJveWVkIiwiYW5pbWF0aW9uU3BlZWQiLCJjcmVhdGVNb2RhbCIsImFkZEV2ZW50TGlzdGVuZXIiLCJoYW5kbGVyQ2xvc2VNb2RhbCIsImJpbmQiLCJDdXN0b21FdmVudCIsImRldGFpbCIsImNyZWF0ZUVsZW1lbnQiLCJtb2RhbEhUTUwiLCJtb2RhbEZvb3RlckhUTUwiLCJjbGFzc0xpc3QiLCJhZGQiLCJ0aXRsZSIsImNvbnRlbnQiLCJmb290ZXJCdXR0b25zIiwiYnV0dG9uIiwibW9kYWxGb290ZXJCdXR0b24iLCJjbGFzcyIsImhhbmRsZXIiLCJ0ZXh0IiwiaW5uZXJIVE1MIiwiYm9keSIsImFwcGVuZENoaWxkIiwic2hvdyIsImRpc3BhdGNoRXZlbnQiLCJoaWRlIiwicmVtb3ZlIiwic2V0VGltZW91dCIsInRhcmdldCIsImRhdGFzZXQiLCJkaXNtaXNzIiwiZGVzdHJveSIsInBhcmVudEVsZW1lbnQiLCJyZW1vdmVDaGlsZCIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJzZXRDb250ZW50IiwiaHRtbCIsInF1ZXJ5U2VsZWN0b3IiLCJzZXRUaXRsZSIsImxhc3RQb3NpdGlvbiIsImNyZWF0ZVBvc2l0aW9uIiwiY2VsbHMiLCJ0b3RhbENlbGxzIiwiQXJyYXkiLCJmcm9tIiwiXyIsImZsYXRNYXAiLCJjZWxsIiwiY3JlYXRlQXJyYXlQb3NpdGlvbnMiLCJyYW5kIiwiTWF0aCIsImZsb29yIiwicmFuZG9tIiwicG9pbnRlciIsIm5vdGFsbG93ZWQiLCJoYW1tZXIiLCJDbGlja0NvdW50ZXIiLCJjb250YWluZXIiLCJoaXRDb3VudCIsIm1pc3NDb3VudCIsImluaXRVSSIsIkhUTUxFbGVtZW50IiwiaW5zZXJ0QWRqYWNlbnRIVE1MIiwiZ2V0SGl0Q291bnQiLCJnZXRNaXNzQ291bnQiLCJoaXRDb3VudEVsIiwibWlzc0NvdW50RWwiLCJpbmNyZW1lbnRIaXQiLCJ1cGRhdGVVSSIsImluY3JlbWVudE1pc3MiLCJ0ZXh0Q29udGVudCIsInJlc2V0IiwiZ2FtZVBsYXkiLCJib2FyZEVsIiwiY2VsbENsaWNrTGlzdGVuZXJzIiwiY2VsbEVudGVyTGlzdGVuZXJzIiwiY2VsbExlYXZlTGlzdGVuZXJzIiwiaXNNb2RhbCIsImluaXRNb2RhbExpc3RlbmVyIiwiYmluZFRvRE9NIiwiY3VycmVudE1vZGFsIiwiZHJhd1VpIiwidGhlbWUiLCJjaGVja0JpbmRpbmciLCJjZWxsRWwiLCJldmVudCIsIm9uQ2VsbEVudGVyIiwib25DZWxsTGVhdmUiLCJvbkNlbGxDbGljayIsImNoaWxkcmVuIiwicmVkcmF3UG9zaXRpb25zIiwicG9zaXRpb24iLCJjaGFyRWwiLCJhZGRDZWxsRW50ZXJMaXN0ZW5lciIsImNhbGxiYWNrIiwicHVzaCIsImFkZENlbGxMZWF2ZUxpc3RlbmVyIiwiYWRkQ2VsbENsaWNrTGlzdGVuZXIiLCJwcmV2ZW50RGVmYXVsdCIsImluZGV4T2YiLCJjdXJyZW50VGFyZ2V0IiwiZm9yRWFjaCIsIm8iLCJjYWxsIiwic2VsZWN0Q2VsbCIsImNvbG9yIiwiYXJndW1lbnRzIiwidW5kZWZpbmVkIiwiZGVzZWxlY3RDZWxsIiwiZmlsdGVyIiwic3RhcnRzV2l0aCIsImhpZGVDZWxsVG9vbHRpcCIsInNldEN1cnNvciIsImN1cnNvciIsInN0eWxlIiwic2hvd01vZGFsTWVzc2FnZSIsIm1lc3NhZ2UiLCJ1bmljb2RlIiwic2hvd01vZGFsIiwibW9kYWwiLCJnYW1lQ3RybCIsImluZGV4U2VsZWN0IiwiY2xpY2tDb3VudGVyIiwiaW5pdCIsImV2ZW50cyIsInNob3dDaGFyYWN0ZXIiLCJyZWFjdE9uQ2xpY2siLCJjdXJzb3JzIiwidGltZXJJZCIsInNldEludGVydmFsIiwicmVzZXRUaW1lciIsImNsZWFySW50ZXJ2YWwiLCJxdWVyeVNlbGVjdG9yQWxsIl0sInNvdXJjZVJvb3QiOiIifQ==